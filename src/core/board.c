#include "board.h"
#include <string.h>

const char SYMBOLS[SYMBOL_COUNT] = {
	BLACK_PAWN,
	BLACK_BISHOP,
	BLACK_ROOK,
	BLACK_KNIGHT,
	BLACK_QUEEN,
	BLACK_KING,
	WHITE_PAWN,
	WHITE_BISHOP,
	WHITE_ROOK,
	WHITE_KNIGHT,
	WHITE_QUEEN,
	WHITE_KING,
	EMPTY,
};

const Count PIECE_VALUES[SQUARE_COUNT] = {
	[PAWN] = 1,
	[BISHOP] = 3,
	[KNIGHT] = 3,
	[ROOK] = 5,
	[QUEEN] = 9,
	[KING] = 0,
	[NO_PIECE] = 0
};

const enum Square PIECE_MAP[128] = {
	[WHITE_PAWN] = PAWN,
	[BLACK_PAWN] = PAWN,
	[WHITE_BISHOP] = BISHOP,
	[BLACK_BISHOP] = BISHOP,
	[WHITE_ROOK] = ROOK,
	[BLACK_ROOK] = ROOK,
	[WHITE_KNIGHT] = KNIGHT,
	[BLACK_KNIGHT] = KNIGHT,
	[WHITE_QUEEN] = QUEEN,
	[BLACK_QUEEN] = QUEEN,
	[WHITE_KING] = KING,
	[BLACK_KING] = KING,
	[EMPTY] = NO_PIECE
};

const struct MoveSet MOVES[SQUARE_COUNT] = {
	[PAWN] = {
		.repeat = False,
		.count = 2,
		.moves = {
			{1, 1},
			{1, -1}
		}
	},
	[BISHOP] = {
		.repeat = True,
		.count = 4,
		.moves = {
			{1, 1},
			{-1, 1},
			{-1, -1},
			{1, -1}
		}
	},
	[ROOK] = {
		.repeat = True,
		.count = 4,
		.moves = {
			{0, 1},
			{-1, 0},
			{0, -1},
			{1, 0}
		}
	},
	[KNIGHT] = {
		.repeat = False,
		.count = 8,
		.moves = {
			{1, 2},
			{-1, 2},
			{-2, 1},
			{-2, -1},
			{-1, -2},
			{1, -2},
			{2, -1},
			{2, 1}
		}
	},
	[QUEEN] = {
		.repeat = True,
		.count = 8,
		.moves = {
			{1, 1},
			{-1, 1},
			{-1, -1},
			{1, -1},
			{0, 1},
			{-1, 0},
			{0, -1},
			{1, 0}
		}
	},
	[KING] = {
		.repeat = False,
		.count = 8,
		.moves = {
			{1, 1},
			{-1, 1},
			{-1, -1},
			{1, -1},
			{0, 1},
			{-1, 0},
			{0, -1},
			{1, 0}
		}
	}
};

const Set FIGURES[SQUARE_COUNT][LAYERS_DEEP][FIGURE_HEIGHT] = {
	[PAWN] = {
		{
			0b0000011111100000000011000011000000011001100110000001100110011000,
			0b0000110000110000000001111110000000000100001000000000010110100000,
			0b0000010110100000000001011010000000000100001000001111111111111111,
			0b1000000000000001101111111111110110000000000000011111111111111111,
		},
		{
			0b0000011111100000000011111111000000011111111110000001111111111000,
			0b0000111111110000000001111110000000000111111000000000011111100000,
			0b0000011111100000000001111110000000000111111000001111111111111111,
			0b1111111111111111111111111111111111111111111111111111111111111111,
		}
	},
	[BISHOP] = {
		{
			0b0000000111000000000001111111000000000101110100000000010000010000,
			0b0001110110010000000101011101100000010000110010000001011001101000,
			0b0001011101101000000100111100100000011011110110000000100110010000,
			0b0000110000110000111111111111111110000000000000011111111111111111,
		},
		{
			0b0000000111000000000001111111000000000111111100000000011111110000,
			0b0001111111110000000111111111100000011111111110000001111111111000,
			0b0001111111111000000111111111100000011111111110000000111111110000,
			0b0000111111110000111111111111111111111111111111111111111111111111,
		}
	},
	[ROOK] = {
		{
			0b1111001111001111100100100100100110011110011110011000000000000001,
			0b1010101001010101101110111101110110101010010101011010101111010101,
			0b1011101111011101101110111101110110111011110111011011101111011101,
			0b1000000000000001111111111111111110000000000000011111111111111111,
		},
		{
			0b1111001111001111111100111100111111111111111111111111111111111111,
			0b1111111111111111111111111111111111111111111111111111111111111111,
			0b1111111111111111111111111111111111111111111111111111111111111111,
			0b1111111111111111111111111111111111111111111111111111111111111111,
		}
	},
	[KNIGHT] = {
		{
			0b0000011111111000000111000000111000110001110000110010000000011001,
			0b0110001111000001010000101001110111001011100000011001100000111101,
			0b1000000000000001111100001011110101000111100000010111110010111101,
			0b0000000010000001111111111111111110000000000000011111111111111111,
		},
		{
			0b0000011111111000000111111111111000111111111111110011111111111111,
			0b0111111111111111011111111111111111111111111111111111111111111111,
			0b1111111111111111111111111111111101111111111111110111110011111111,
			0b0000000011111111111111111111111111111111111111111111111111111111,
		}
	},
	[QUEEN] = {
		{
			0b1111111001111111101000111100010110101000000101011000111001110001,
			0b1110001111000111001010011001010001101011110101101111100110011111,
			0b0000110110110000000011011011000000111001100111001110001111000111,
			0b1000000000000001111111111111111110000000000000011111111111111111,
		},
		{
			0b1111111001111111111111111111111111111111111111111111111111111111,
			0b1111111111111111001111111111110001111111111111101111111111111111,
			0b0000111111110000000011111111000000111111111111001111111111111111,
			0b1111111111111111111111111111111111111111111111111111111111111111,
		}
	},
	[KING] = {
		{
			0b0000011111100000000001000010000000011101101110000001000110001000,
			0b0001011111101000000100011000100000011101101110000100010110100010,
			0b1110010110100111111111011011111110000001100000011010010000100101,
			0b1011011001101101111111111111111110000000000000011111111111111111,
		},
		{
			0b0000011111100000000001111110000000011111111110000001111111111000,
			0b0001111111111000000111111111100000011111111110000100011111100010,
			0b1110011111100111111111111111111111111111111111111111111111111111,
			0b1111111111111111111111111111111111111111111111111111111111111111,
		}
	}
};

void _init_squares(Board board) {

	for (Index i = 0, r = 0; r < RANKS; ++r) {

		for (Index f = 0; f < FILES; ++f) {

			board[i] = EMPTY;
			++i;
		}

		++i;
	}
}

void init_captures(Captures captures) {

	memcpy(captures, EMPTY_CAPTURES, CAPTURE_LENGTH * sizeof(char));
	captures[CAPTURE_LENGTH - 1] = '\0';
}

Bool is_piece(const Piece piece)
{
	const Piece p = piece - ('a' - 'A') * (piece > 'R');
	return p == WHITE_PAWN || p == WHITE_KING || p == WHITE_QUEEN || p == WHITE_BISHOP || p == WHITE_KNIGHT || p == WHITE_ROOK;
}

void init_board(Board board) {

	memset(board, '\n', BOARD_LENGTH * sizeof(char));
	_init_squares(board);
	TERMINATE(board);
}